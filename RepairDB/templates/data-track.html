{% extends 'datasubmit_template.html' %}
{% load static %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <ul class="nav nav-pills nav-stacked" id="opt-lis">
                    <li role="presentation" class="active" id="id-li-number-summary"><a href="#">缺陷数量统计</a></li>
                    <li role="presentation" id="id-li-size-summary"><a href="#">缺陷尺寸分布</a></li>
                    <li role="presentation" id="id-li-evolution"><a href="#">缺陷数量演化</a></li>
                    <li role="presentation" id="id-li-defect-track"><a href="#">缺陷跟踪</a></li>
                </ul>
            </div>

            <div class="col-md-9">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title" id="panel2_title">限定数据范围</h3>
                    </div>
                    <div class="panel-body">
                        <form method="post" novalidate>

                            <div class="form-group" id="id-div-jtype">
                                <label>选择机型</label>
                                <select name="jet_type" class="form-control" id="id-select-jtype"
                                        onchange="select_change_event('jtype')">
                                    <option value="all">不限定</option>
                                    <option value="as_x" class="as_x">设为分析自变量</option>
                                </select>
                            </div>

                            <div class="form-group" id="id-div-servearea">
                                <label>选择服役地点</label>
                                <select name="jet_type" class="form-control" id="id-select-serve_area"
                                        onchange="select_change_event('servearea')">
                                    <option value="all">不限定</option>
                                    <option value="as_x" class="as_x">设为分析自变量</option>
                                </select>
                            </div>

                            <div class="form-group" id="id-div-jid">
                                <label>选择飞机编号</label>
                                <select class="form-control" id="id-select-jid" onchange="select_change_event('jid')">
                                    <option value="all">不限定</option>
                                    <option value="as_x" class="as_x">设为分析自变量</option>
                                </select>
                            </div>

                            <div class="form-group" id="id-div-jcomp">
                                <label>选择部件</label>
                                <select class="form-control" id="id-select-jcomp"
                                        onchange="select_change_event('jcomp')">
                                    <option value="all">不限定</option>
                                    <option value="as_x" class="as_x">设为分析自变量</option>
                                </select>
                            </div>

                            <div class="form-group" id="id-div-jpart">
                                <label>选择零件</label>
                                <select class="form-control" id="id-select-jpart"
                                        onchange="select_change_event('jpart')">
                                    <option value="all">不限定</option>
                                    <option value="as_x" class="as_x">设为分析自变量</option>
                                </select>
                            </div>

                            <div class="form-group" id="id-div-detect-time">
                                <label>选择检测节点</label>
                                <select class="form-control" id="id-select-detect_time"
                                        onchange="select_change_event('detect-time')">
                                    <option value="all">不限定</option>
                                    <option value="as_x" class="as_x">设为分析自变量</option>
                                </select>
                            </div>

                            <div class="form-group" id="id-div-defect-type">
                                <label>选择损伤类型</label>
                                <select class="form-control" id="id-select-defect_type"
                                        onchange="select_change_event('defect-type')">
                                    <option value="all">不限定</option>
                                    <option value="as_x" class="as_x">设为分析自变量</option>
                                </select>
                            </div>

                            <div class="form-group" id="id-div-location-type">
                                <label>选择损伤区域类型</label>
                                <select class="form-control" id="id-select-location_type"
                                        onchange="select_change_event('location-type')">
                                    <option value="all">不限定</option>
                                    <option value="as_x" class="as_x">设为分析自变量</option>
                                </select>
                            </div>

                            <div class="form-group" id="id-div-distribution-law">
                                <label>选择回归分布律模型</label>
                                <select class="form-control" id="id-select-distribution_law"
                                        onchange="select_change_event('distribution-law')">
                                    <option value="auto">自动最优正偏态模型</option>
                                    <option value="log-exp">对数正态分布</option>
                                    <option value="Weibull">Weibull分布</option>
                                    <option value="Rayleigh">Rayleigh分布</option>
                                    <option value="Gama">Gama分布</option>
                                </select>
                            </div>

                            <div class="form-group" id="id-div-evolution-law">
                                <label>选择演化回归模型</label>
                                <select class="form-control" id="id-select-evolution_law"
                                        onchange="select_change_event('evolution-law')">
                                    <option value="linear">线性回归</option>
                                    <option value="quadra">二次多项式回归</option>
                                    <option value="gaussian">指数函数回归</option>
                                </select>
                            </div>

                            <button type="button" class="btn btn-primary" id="button"
                                    onclick="number_summary_event('query')">查询
                            </button>
                        </form>
                    </div>
                </div>
{#                <div style="width: 100%;height: 400px;" id="chart-demo"></div>#}
                <div class="panel panel-default" id="id-table-panel">
                    <div class="panel-heading">缺陷列表</div>
                    <div class="panel-body" id="id-body-table">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>所在飞机编号</th>
                                <th>所在部件</th>
                                <th>所在零件</th>
                                <th>损伤区域类型</th>
                                <th>损伤类型</th>
                                <th>初次检出时间</th>
                            </tr>
                            </thead>
                            <tbody id="table-list-body">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="panel panel-default" id="id-chart-panel">
                    <div class="panel-heading">缺陷数量统计图</div>
                    <div class="panel-body" id="id-body-chart">
                        <div id="chart-1" style="width: 100%;height: 400px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{#    模态框#}
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">缺陷详情和演化</h4>
                </div>
                <div class="modal-body" id="my_modal_content">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭预览</button>
                </div>
            </div>
        </div>
    </div>

{% endblock %}


{##}
{% block js %}
    <script src="{% static 'js/ecStat.min.js' %}"></script>
    <script src="{% static 'js/echarts.js' %}"></script>
{#    <script src="https://fastly.jsdelivr.net/npm/echarts-stat@latest/dist/ecStat.min.js"></script>#}
    <script type="text/javascript">
        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}'}
        });

        var myChart;//全局变量
        var uint;

        $(function () {
            li_clicked_event()
            $("#id-li-number-summary").click()
            number_summary_event('init')
        })

        function li_clicked_event() {
            $("#id-li-number-summary").click(function () {
                change_option([1, 0, 0, 0])
            })
            $("#id-li-size-summary").click(function () {
                change_option([0, 1, 0, 0])
            })
            $("#id-li-evolution").click(function () {
                change_option([0, 0, 1, 0])
            })
            $("#id-li-defect-track").click(function () {
                change_option([0, 0, 0, 1])
            })
        }

        function number_summary_event(message = 'query') {
            // log 一下
            var chart_p = document.getElementById("id-chart-panel")
            console.log('number summary')
            // 初始
            if (message === "init") {
                chart_p.hidden = true
                $.ajax({
                    url: "/data-service/data_track/query_init/",
                    type: "post",

                    success: function (res) {
                        // 解析接收到的数组
                        update_selects(res)
                        // 更新下拉框选项
                    },
                })
            }
            // 下拉框改变后筛选数据
            else {
                chart_p.hidden = false
                var jtype_select = document.getElementById('id-select-jtype').selectedIndex
                var serve_area_select = document.getElementById('id-select-serve_area').selectedIndex
                var jid_select = document.getElementById('id-select-jid').selectedIndex
                var jcomp_select = document.getElementById('id-select-jcomp').selectedIndex
                var jpart_select = document.getElementById('id-select-jpart').selectedIndex
                var detect_time_select = document.getElementById('id-select-detect_time').selectedIndex
                var defect_type_select = document.getElementById('id-select-defect_type').selectedIndex
                var location_type_select = document.getElementById('id-select-location_type').selectedIndex
                var chart_div = document.getElementById('id-body-chart')
                while (chart_div.firstChild) {
                    chart_div.removeChild(chart_div.firstChild)
                }
                var option = {
                    title: {
                        text: [],
                        textAlign: "auto",
                        left: "center",
                    },
                    tooltip: {},
                    legend: {
                        data: [],  // 后台获取
                        bottom: 0
                    },
                    xAxis: {
                        data: []  // 后台获取
                    },
                    yAxis: {},
                    series: []  // 后台获取
                };
                $.ajax({
                    url: "/data-service/data_track/query_number/",
                    type: "post",
                    data: {
                        "jtype": jtype_select, "serve_area": serve_area_select, "jid": jid_select,
                        "jcomp": jcomp_select, "jpart": jpart_select, "detect_time": detect_time_select,
                        "defect_type": defect_type_select, "location_type": location_type_select
                    },
                    success: function (res) {
                        // 解析接收到的res 并更新option
                        console.log(res)
                        var keys = Object.keys(res)
                        var values = Object.values(res)
                        for (i = 0; i < keys.length; i++) {
                            tmp_div = document.createElement("div")
                            tmp_div.id = "chart-" + i.toString()
                            tmp_div.style = "width: 100%;height: 400px;"
                            chart_div.appendChild(tmp_div)
                            console.log(chart_div)
                            var tmp_key = keys[i]
                            var tmp_value = values[i]
                            option.title.text = tmp_value.title
                            option.legend.data = tmp_value.legend;
                            option.xAxis.data = tmp_value.x_axis;
                            option.series = [
                                {
                                    "name": tmp_value.tmp_key,
                                    "type": "bar",
                                    "data": tmp_value.series
                                }
                            ];
                            var myChart = echarts.init(document.getElementById("chart-" + i.toString()))
                            myChart.setOption(option);
                        }
                    },
                })

            }
        }

        function size_summary_event() {
            console.log('size summary')
            var chart_p = document.getElementById("id-chart-panel")
            chart_p.hidden = false
            var jtype_select = document.getElementById('id-select-jtype').selectedIndex
            var serve_area_select = document.getElementById('id-select-serve_area').selectedIndex
            var jid_select = document.getElementById('id-select-jid').selectedIndex
            var jcomp_select = document.getElementById('id-select-jcomp').selectedIndex
            var jpart_select = document.getElementById('id-select-jpart').selectedIndex
            var detect_time_select = document.getElementById('id-select-detect_time').selectedIndex
            var defect_type_select = document.getElementById('id-select-defect_type').selectedIndex
            var location_type_select = document.getElementById('id-select-location_type').selectedIndex
            var distribution_law_select = document.getElementById('id-select-distribution_law').selectedIndex
            var chart_div = document.getElementById('id-body-chart')
            while (chart_div.firstChild) {
                chart_div.removeChild(chart_div.firstChild)
            }
            var option = {
                unit: '',
                title: {
                    text: '',                                                                                                                                                   // 从后台获取 'title'
                    textAlign: "auto",
                    left: "center",
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: '#999'
                        }
                    }
                },
                toolbox: {
                    feature: {
                        dataView: {show: true, readOnly: false},
                        {#magicType: {show: true, type: ['line', 'bar']},#}
                        restore: {show: true},
                        saveAsImage: {show: true}
                    }
                },
                legend: {
                    data: ['item', 'integral', 'law'],                                                                                                                          // 后台获取，图注
                    bottom: 0
                },
                xAxis: {
                    data: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20],                                                                              // 后台获取，x坐标
                    silent: false,
                    splitLine: {
                        show: false
                    },
                    splitArea: {
                        show: false
                    }
                },
                yAxis: {
                    splitArea: {
                        show: false
                    }
                },
                series: [
                    {
                        name: 'item',
                        type: 'bar',
                        tooltip: {
                            valueFormatter: function (value) {
                                return value + option.unit;
                            }                                                                                      // 后台获取，单位，
                        },
                        data: [2.6, 5.9, 9.0, 26.4, 28.7, 70.7, 75.6, 82.2, 48.7, 18.8, 6.0, 2.3, 18.8, 6.0, 2.3, 18.8, 6.0, 2.3, 2.3, 18.8, 6.0, 2.3, 2.3, 18.8, 6.0, 2.3]     // 后台获取，真实分布
                    },
                    {
                        name: 'integral',
                        type: 'line',
                        data: [2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2, 23.4, 23.0, 16.5, 12.0, 16.2, 16.5, 22.0, 26.2, 26.5, 32.0, 36.2]              // 后台获取，积分真实分布
                    },
                    {
                        name: 'law',
                        type: 'line',
                        smooth: true,
                        data: [2.6, 5.9, 9.0, 26.4, 28.7, 70.7, 75.6, 82.2, 48.7, 18.8, 6.0, 2.3, 18.8, 6.0, 2.3, 18.8, 6.0, 2.3, 2.3, 18.8, 6.0, 2.3, 2.3, 18.8, 6.0, 2.3]     // 后台获取，分布律的分布
                    }
                ]
            };

            $.ajax({
                url: "/data-service/data_track/query_size/",
                type: "post",
                data: {
                    "jtype": jtype_select,
                    "serve_area": serve_area_select,
                    "jid": jid_select,
                    "jcomp": jcomp_select,
                    "jpart": jpart_select,
                    "detect_time": detect_time_select,
                    "defect_type": defect_type_select,
                    "location_type": location_type_select,
                    'distribution_law': distribution_law_select
                },
                success: function (res) {
                    // 解析接收到的res 并更新option
                    console.log(res)
                    var keys = Object.keys(res)
                    var values = Object.values(res)
                    for (i = 0; i < keys.length; i++) {
                        tmp_div = document.createElement("div")
                        tmp_div.id = "chart-" + i.toString()
                        tmp_div.style = "width: 100%; height: 400px;"
                        chart_div.appendChild(tmp_div)
                        var tmp_key = keys[i]
                        var tmp_value = values[i]
                        option.title.text = tmp_value.title
                        option.legend.data = tmp_value.legend;
                        option.xAxis.data = tmp_value.x_axis;
                        option.unit = tmp_value.unit;
                        option.series[0].data = tmp_value.data_item;
                        option.series[1].data = tmp_value.data_integral;
                        option.series[2].data = tmp_value.dist_law;
                        option.series[0].name = tmp_value.legend[0];
                        option.series[1].name = tmp_value.legend[1];
                        option.series[2].name = tmp_value.legend[2];
                        var myChart = echarts.init(document.getElementById("chart-" + i.toString()))
                        myChart.setOption(option);
                    }
                },
            })

        }

        function evolution_summary_event() {
            console.log('evolution summary')
            var chart_p = document.getElementById("id-chart-panel")
            chart_p.hidden = false
            var jtype_select = document.getElementById('id-select-jtype').selectedIndex
            var serve_area_select = document.getElementById('id-select-serve_area').selectedIndex
            var jid_select = document.getElementById('id-select-jid').selectedIndex
            var jcomp_select = document.getElementById('id-select-jcomp').selectedIndex
            var jpart_select = document.getElementById('id-select-jpart').selectedIndex
            var defect_type_select = document.getElementById('id-select-defect_type').selectedIndex
            var location_type_select = document.getElementById('id-select-location_type').selectedIndex
            var evolution_law_select = document.getElementById('id-select-evolution_law').selectedIndex
            var chart_div = document.getElementById('id-body-chart')
            while (chart_div.firstChild) {
                chart_div.removeChild(chart_div.firstChild)
            }
            echarts.registerTransform(ecStat.transform.regression);
            var option = {
                dataset: [
                    {
                        source: [[0, 0]]                        // 后台获取：data
                    },
                    {
                        transform: {
                            type: 'ecStat:regression',
                            config: {
                                method: 'polynomial',           // 后台获取：func_type
                                order: 3                        // 后台获取：func_type
                            }
                        }
                    }
                ],
                title: {
                    text: '',                                   // 后台获取：title
                    left: 'center',
                    top: 16
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                xAxis: {
                    scale: true,
                    splitLine: {
                        lineStyle: {
                            type: 'dashed'
                        }
                    },
                    splitNumber: 10
                },
                yAxis: {
                    scale: true,
                    splitLine: {
                        lineStyle: {
                            type: 'dashed'
                        }
                    }
                },
                series: [
                    {
                        name: 'scatter',
                        type: 'scatter'
                    },
                    {
                        name: 'line',
                        type: 'line',
                        smooth: true,
                        datasetIndex: 1,
                        symbolSize: 0.1,
                        symbol: 'circle',
                        label: {show: true, fontSize: 16},
                        labelLayout: {dx: -20},
                        encode: {label: 2, tooltip: 1}
                    }
                ]
            };
            {##}
            $.ajax({
                url: "/data-service/data_track/query_evolution/",
                type: "post",
                data: {
                    "jtype": jtype_select,
                    "serve_area": serve_area_select,
                    "jid": jid_select,
                    "jcomp": jcomp_select,
                    "jpart": jpart_select,
                    "defect_type": defect_type_select,
                    "location_type": location_type_select,
                    'evolution_law': evolution_law_select
                },
                success: function (res) {
                    // 解析接收到的res 并更新option
                    console.log(res)
                    var keys = Object.keys(res)
                    var values = Object.values(res)
                    for (i = 0; i < keys.length; i++) {
                        tmp_div = document.createElement("div")
                        tmp_div.id = "chart-" + i.toString()
                        tmp_div.style = "width: 100%; height: 400px;"
                        chart_div.appendChild(tmp_div)
                        var tmp_key = keys[i]
                        var tmp_value = values[i]
                        option.title.text = tmp_value.title
                        option.dataset[0].source = tmp_value.data
                        option.dataset[1].transform.config = tmp_value.func_type
                        console.log(option)
                        var myChart = echarts.init(document.getElementById("chart-" + i.toString()))
                        myChart.setOption(option);
                    }
                },
             })
        }

        function defect_track_event() {
            console.log('evolution summary')
            var chart_p = document.getElementById("id-chart-panel")
            var jtype_select = document.getElementById('id-select-jtype').selectedIndex
            var serve_area_select = document.getElementById('id-select-serve_area').selectedIndex
            var jid_select = document.getElementById('id-select-jid').selectedIndex
            var jcomp_select = document.getElementById('id-select-jcomp').selectedIndex
            var jpart_select = document.getElementById('id-select-jpart').selectedIndex
            var defect_type_select = document.getElementById('id-select-defect_type').selectedIndex
            var location_type_select = document.getElementById('id-select-location_type').selectedIndex
            var chart_div = document.getElementById('id-body-chart')
            var table_body = document.getElementById('table-list-body')
            while (table_body.firstChild) {
                table_body.removeChild(table_body.firstChild)
            }
            while (chart_div.firstChild) {
                chart_div.removeChild(chart_div.firstChild)
            }
            echarts.registerTransform(ecStat.transform.regression);
            var option = {
                dataset: [
                    {
                        source: [[0, 0]]                        // 后台获取：data
                    },
                    {
                        transform: {
                            type: 'ecStat:regression',
                            config: {
                                method: 'polynomial',           // 后台获取：func_type
                                order: 3                        // 后台获取：func_type
                            }
                        }
                    }
                ],
                title: {
                    text: '',                                   // 后台获取：title
                    left: 'center',
                    top: 16
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                xAxis: {
                    scale: true,
                    splitLine: {
                        lineStyle: {
                            type: 'dashed'
                        }
                    },
                    splitNumber: 10
                },
                yAxis: {
                    scale: true,
                    splitLine: {
                        lineStyle: {
                            type: 'dashed'
                        }
                    }
                },
                series: [
                    {
                        name: 'scatter',
                        type: 'scatter'
                    },
                    {
                        name: 'line',
                        type: 'line',
                        smooth: true,
                        datasetIndex: 1,
                        symbolSize: 0.1,
                        symbol: 'circle',
                        label: {show: true, fontSize: 16},
                        labelLayout: {dx: -20},
                        encode: {label: 2, tooltip: 1}
                    }
                ]
            };
            {##}
            $.ajax({
                url: "/data-service/data_track/query_defect/",
                type: "post",
                data: {
                    "jtype": jtype_select,
                    "serve_area": serve_area_select,
                    "jid": jid_select,
                    "jcomp": jcomp_select,
                    "jpart": jpart_select,
                    "defect_type": defect_type_select,
                    "location_type": location_type_select
                },
                success: function (res) {
                    // 解析接收到的res 并更新option
                    console.log(res)
                    var defects = res.defect_list
                    for (i = 0; i < defects.length; i++) {
                        tmp_tr = document.createElement("tr")
                        tmp_defect = defects[i]
                        var values = Object.values(tmp_defect)
                        for (j = 0; j < values.length; j++) {
                            tmp_th = document.createElement('th')
                            tmp_th.innerText = values[j]
                            if (j === 0) {tmp_th.innerText = i.toString()}
                            tmp_tr.appendChild(tmp_th)
                        }
                        tmp_tr.onclick = function () {view_defect_detail_event(tmp_defect.id)}
                        table_body.appendChild(tmp_tr)
                    }
                },
            })
        }

        function change_option(opt_array = [1, 0, 0, 0]) {
            // 更改选中的active属性
            all_lis = document.getElementById("opt-lis").children
            for (var i = 0; i < opt_array.length; i++) {
                if (opt_array[i] === 0) {
                    all_lis[i].className = ''
                } else if (opt_array[i] === 1) {
                    all_lis[i].className = 'active'
                }
            }
            // 为button绑定不同响应事件
            var button = document.getElementById('button')
            // 隐藏结果框
            var chart_p = document.getElementById("id-chart-panel")
            chart_p.hidden = true
            // 更新选择限定select框的显隐性
            var all_as_x = document.getElementsByClassName('as_x')
            var distribution_law = document.getElementById('id-div-distribution-law')
            var evolution_law = document.getElementById('id-div-evolution-law')
            var detect_stage = document.getElementById('id-div-detect-time')
            var detect_list = document.getElementById('id-table-panel')
            if (opt_array[0] === 1) {
                for (as_x_li of all_as_x) {
                    as_x_li.hidden = false
                }
                button.onclick = number_summary_event
                distribution_law.hidden = true
                evolution_law.hidden = true
                detect_stage.hidden = false
                detect_list.hidden = true
            } else if (opt_array[1] === 1) {
                button.onclick = size_summary_event
                for (as_x_li of all_as_x) {
                    as_x_li.hidden = true
                }
                distribution_law.hidden = false
                evolution_law.hidden = true
                detect_stage.hidden = false
                detect_list.hidden = true
            } else if (opt_array[2] === 1) {
                button.onclick = evolution_summary_event
                for (as_x_li of all_as_x) {
                    as_x_li.hidden = true
                }
                distribution_law.hidden = true
                evolution_law.hidden = false
                detect_stage.hidden = true
                detect_list.hidden = true
            } else if (opt_array[3] === 1) {
                button.onclick = defect_track_event
                for (as_x_li of all_as_x) {
                    as_x_li.hidden = true
                }
                distribution_law.hidden = true
                evolution_law.hidden = true
                detect_stage.hidden = true
                detect_list.hidden = false
            }
        }

        function update_selects(response) {
            var keys = Object.keys(response)
            var values = Object.values(response)

            for (i = 0; i < keys.length; i++) {
                var tmp_id = "id-select-" + keys[i]
                var tmp_select = document.getElementById(tmp_id)
                {#while (tmp_select.firstChild) {#}
                {#    tmp_select.removeChild(tmp_select.firstChild);#}
                {# }#}
                for (j = 0; j < values[i].length; j++) {
                    var tmp_opt = document.createElement("option")
                    tmp_opt.text = values[i][j]
                    tmp_select.appendChild(tmp_opt)
                }
            }
        }

        function select_change_event() {
        }

        function view_defect_detail_event(id) {
            var modal_content = document.getElementById('my_modal_content')
            var option = {
                xAxis: {
                    type: 'category',
                    data: []        // 后台获取flight_time
                },
                yAxis: [
                    {name: "size (mm)", type: 'value'},
                    {name: "area (mm^2)", type: 'value', alignTicks: true}
                ],
                legend: {},
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                series: [
                    {name: 'size_z', type: 'line', yAxisIndex: 0, data: []},        // 后台获取size_z
                    {name: 'size_x', type: 'line', yAxisIndex: 0, data: []},        // 后台获取size_x
                    {name: 'area', type: 'line', yAxisIndex: 1, data: []}           // 后台获取area
                ]
            };
            while (modal_content.firstChild) {
                modal_content.removeChild(modal_content.firstChild)
            }
            $.ajax({
                url: "/data-service/data_track/query_defect/",
                type: "get",
                data: {
                    "defect_id": id,
                },
                success: function (res) {
                    // 解析接收到的res 并更新option

                    $("#myModal").modal("show")
                    console.log(res)
                    option.xAxis.data = res.flight_time
                    option.series[0].data = res.size_z
                    option.series[1].data = res.size_x
                    option.series[2].data = res.area
                    var tmp_div = document.createElement("div")
                    modal_content.appendChild(tmp_div)
                    tmp_div.id = "chart_defect_evolution"
                    tmp_div.style = "width: 100%; height: 400px;"
                    var myChart = echarts.init(tmp_div)
                    $('#myModal').on('shown.bs.modal', function () {
                        myChart.resize()
                    })
                    myChart.setOption(option);
                },
            })

        }
    </script>
{% endblock %}