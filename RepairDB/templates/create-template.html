{% extends 'datasubmit_template.html' %}
{% load static %}

{% block content %}

    <div class="container">
        <div class="panel panel-default">
            <div class="panel-body">
                <form method="post" novalidate>
                    {% csrf_token %}
                    {#选择数据类型-损伤、修复、模拟的下拉框#}
                    {% for field in template_form %}
                        <div class="form-group">
                            <label>{{ field.label }}</label>
                            {{ field }}
                            <span style="color: red;">{{ field.errors.0 }}</span>
                        </div>
                    {% endfor %}
                    <button type="button" id="id_preview" class="btn btn-primary">预 览</button>
                    <button type="submit" class="btn btn-primary">提交审核</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">预览数据模板</h4>
                </div>

                <div class="modal-body" id="my_modal_content">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭预览</button>
                </div>
            </div>
        </div>
    </div>


{% endblock %}



{% block js %}
    <script type="text/javascript">

        $(function () {
            var li1 = document.getElementById("create-li-1")
            var li2 = document.getElementById("create-li-2")
            li1.innerHTML='<a href="/create-data/new/">数据</a>'
            li2.innerHTML='<a href="/create-template/new/">模板</a>'
            preview_template();
        })

        function preview_template() {
            $("#id_preview").click(function () {
                var template_json_str = document.getElementById("id_template_item").value;
                // 浅log一下
                var display_place = document.getElementById("my_modal_content")
                while (display_place.firstChild) {
                    display_place.removeChild(display_place.firstChild);
                }
                console.log(template_json_str)
                template_json = jQuery.parseJSON(template_json_str);
                console.log(template_json)
                var keys = Object.keys(template_json.content)
                for (i = 0; i < template_json.num_key; i++) {
                    // 当前条目
                    var temp_item = template_json.content[keys[i]]
                    var temp_label = document.createElement("label")
                    temp_label.innerText = temp_item.name
                    var ftype = temp_item.type
                    if (ftype == 1) {
                        // 基本input框
                        var temp_input = document.createElement("input")
                        var temp_div = document.createElement("div")
                        temp_div.className = 'form-group'
                        temp_input.className = "form-control"
                        temp_input.id = "input" + i.toString()
                        temp_input.name = "input" + i.toString()
                        temp_div.appendChild(temp_input)

                    } else if (ftype == 2) {
                        // 文选选择和上传
                        var temp_div = document.createElement("div")
                        var temp_input = document.createElement("input")
                        temp_div.className = 'form-group'
                        {#temp_input.className = "form-control"#}
                        temp_input.type = "file"
                        temp_input.id = "file_input" + i.toString()
                        temp_input.name = "file_input" + i.toString()
                        temp_div.appendChild(temp_input)
                    }
                    // 把当前child 加入到文档列表中
                    display_place.appendChild(temp_label)
                    display_place.appendChild(temp_div)
                }
                $("#myModal").modal("show")

            })
        }

    </script>
{% endblock %}